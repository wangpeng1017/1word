<!--pages/study/study.wxml-->
<view class="container study-page {{isCorrect && showResult ? 'celebrate' : ''}}">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="study-header">
    <view class="header-info">
      <text class="word-count">å½“å‰å•è¯ï¼ˆç¬¬ {{currentIndex + 1}}/{{totalCount}} ä¸ªï¼‰</text>
      <text class="time-spent">å·²ç”¨æ—¶ {{elapsedTime}}</text>
    </view>
    <view class="exit-btn" bindtap="exitStudy">Ã—</view>
  </view>
  
  <!-- è¶£å‘³è¿›åº¦æ¡ -->
  <view class="fun-progress">
    <view class="progress-track">
      <view class="progress-fill" style="width: {{progress}}%">
        <text class="progress-emoji">ğŸš€</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç­”é¢˜åŒºåŸŸ -->
  <view wx:else class="study-content">
    <!-- é€‰æ‹©é¢˜æ¨¡å¼1: è‹±æ–‡å•è¯ + 4ä¸ªä¸­æ–‡é‡Šä¹‰é€‰é¡¹ -->
    <view wx:if="{{currentQuestion.type === 'ENGLISH_TO_CHINESE'}}" class="word-display">
      <view class="word-row">
        <text class="word-text">{{currentTask.vocabulary.word}}</text>
        <view class="speaker" bindtap="playAudio">ğŸ”Š</view>
      </view>
      <text class="question-hint">è¯·é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼2: æ±‰è¯­ + 4ä¸ªè‹±æ–‡å•è¯é€‰é¡¹ -->
    <view wx:elif="{{currentQuestion.type === 'CHINESE_TO_ENGLISH'}}" class="word-display">
      <view wx:if="{{currentTask.vocabulary.meanings && currentTask.vocabulary.meanings.length > 0}}" class="meanings-display">
        <view wx:for="{{currentTask.vocabulary.meanings}}" wx:key="id" class="meaning-item">
          <text class="pos-tag">{{item.partOfSpeech}}</text>
          <text class="meaning-text">{{item.meaning}}</text>
        </view>
      </view>
      <text wx:else class="word-text chinese-text">{{currentTask.vocabulary.primaryMeaning}}</text>
      <text class="question-hint">è¯·é€‰æ‹©æ­£ç¡®çš„è‹±æ–‡å•è¯</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼3: è‹±æ–‡å•è¯è¯»éŸ³ + 4ä¸ªè‹±æ–‡å•è¯é€‰é¡¹ -->
    <view wx:elif="{{currentQuestion.type === 'LISTENING'}}" class="word-display">
      <view class="audio-icon" bindtap="playAudio">ğŸ”Š</view>
      <text class="question-hint">å¬éŸ³é€‰è¯</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼4: é€‰è¯å¡«ç©º -->
    <view wx:elif="{{currentQuestion.type === 'FILL_IN_BLANK'}}" class="word-display">
      <view class="sentence-display">
        <text class="sentence-text">{{currentQuestion.sentence}}</text>
      </view>
      <text class="question-hint">é€‰æ‹©æ­£ç¡®çš„å•è¯å¡«ç©º</text>
    </view>
    
    <!-- é»˜è®¤æ˜¾ç¤º -->
    <view wx:else class="word-display">
      <text class="word-text">{{currentTask.vocabulary.word}}</text>
    </view>

    <!-- é€‰é¡¹åˆ—è¡¨ -->
    <view class="options-list">
      <view 
        wx:for="{{currentQuestion.options}}" 
        wx:key="id"
        class="option-item {{selectedAnswer === item.content ? 'selected' : ''}} {{isAnswered && item.content === currentQuestion.correctAnswer ? 'correct' : ''}} {{isAnswered && selectedAnswer === item.content && !isCorrect ? 'wrong' : ''}}"
        data-answer="{{item.content}}"
        bindtap="selectAnswer"
      >
        <view class="option-label">{{index === 0 ? 'A' : index === 1 ? 'B' : index === 2 ? 'C' : 'D'}}</view>
        <view class="option-content">{{item.content}}</view>
        <view wx:if="{{isAnswered && item.content === currentQuestion.correctAnswer}}" class="option-icon">âœ“</view>
        <view wx:elif="{{isAnswered && selectedAnswer === item.content && !isCorrect}}" class="option-icon">âœ—</view>
      </view>
    </view>

    <!-- ç»“æœåé¦ˆï¼ˆå›ºå®šåº•éƒ¨ï¼‰ -->
    <view wx:if="{{showResult}}" class="result-bar {{isCorrect ? 'ok' : 'bad'}}">
      <view class="result-main">
        <text class="result-icon">{{isCorrect ? 'âœ“' : 'âœ—'}}</text>
        <text class="result-text">{{isCorrect ? 'å›ç­”æ­£ç¡®' : 'ç­”é”™äº†'}}</text>
        
        <!-- é”™è¯¯æ—¶æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ -->
        <view wx:if="{{!isCorrect}}" class="result-detail">
          <text class="result-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
          <text class="result-value">{{currentQuestion.correctAnswer}}</text>
        </view>
        
        <!-- é‡Šä¹‰å±•ç¤º -->
        <view wx:if="{{currentTask.vocabulary.meanings && currentTask.vocabulary.meanings.length > 0}}" class="result-meanings">
          <view wx:for="{{currentTask.vocabulary.meanings}}" wx:key="id" class="result-meaning-item">
            <text class="meaning-pos">{{item.partOfSpeech}}</text>
            <text class="meaning-content">{{item.meaning}}</text>
          </view>
        </view>
        <text wx:elif="{{currentQuestion.correctAnswer != currentTask.vocabulary.primaryMeaning}}" class="result-meaning">{{currentTask.vocabulary.primaryMeaning}}</text>
      </view>

      <view wx:if="{{isCorrect}}" class="fireworks">
        <view class="firework firework-1"></view>
        <view class="firework firework-2"></view>
        <view class="firework firework-3"></view>
        <view class="firework firework-4"></view>
        <view class="firework firework-5"></view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® / ç»§ç»­æŒ‰é’® -->
    <view class="submit-section">
      <button 
        wx:if="{{!isAnswered}}" 
        class="submit-btn" 
        bindtap="submitAnswer" 
        disabled="{{!selectedAnswer}}"
      >
        æäº¤ç­”æ¡ˆ
      </button>
      <button 
        wx:elif="{{isAnswered && !isCorrect}}" 
        class="submit-btn continue-btn" 
        bindtap="nextQuestion"
      >
        ç»§ç»­
      </button>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ (ç»“æœæ˜¾ç¤ºæ—¶éšè—ï¼Œé¿å…é®æŒ¡) -->
    <view class="stats-section" wx:if="{{!showResult}}">
      <view class="stat-item">
        <text class="stat-value correct-color">{{correctCount}}</text>
        <text class="stat-label">æ­£ç¡®</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value wrong-color">{{wrongCount}}</text>
        <text class="stat-label">é”™è¯¯</text>
      </view>
    </view>
  </view>
</view>
