<!--pages/study/study.wxml-->
<view class="container study-page">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="study-header">
    <view class="header-info">
      <text class="word-count">å½“å‰å•è¯ï¼ˆç¬¬ {{currentIndex + 1}}/{{totalCount}} ä¸ªï¼‰</text>
      <text class="time-spent">å·²ç”¨æ—¶ {{elapsedTime}}</text>
    </view>
    <view class="exit-btn" bindtap="exitStudy">Ã—</view>
  </view>
  
  <!-- è¶£å‘³è¿›åº¦æ¡ -->
  <view class="fun-progress">
    <view class="progress-track">
      <view class="progress-fill" style="width: {{progress}}%">
        <text class="progress-emoji">ğŸš€</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç­”é¢˜åŒºåŸŸ -->
  <view wx:else class="study-content">
    <!-- é€‰æ‹©é¢˜æ¨¡å¼1: è‹±æ–‡å•è¯ + 4ä¸ªä¸­æ–‡é‡Šä¹‰é€‰é¡¹ -->
    <view wx:if="{{currentQuestion.type === 'ENGLISH_TO_CHINESE'}}" class="word-display">
      <text class="word-text">{{currentTask.vocabulary.word}}</text>
      <text class="question-hint">è¯·é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼2: æ±‰è¯­ + 4ä¸ªè‹±æ–‡å•è¯é€‰é¡¹ -->
    <view wx:elif="{{currentQuestion.type === 'CHINESE_TO_ENGLISH'}}" class="word-display">
      <text class="word-text chinese-text">{{currentTask.vocabulary.primaryMeaning}}</text>
      <text class="question-hint">è¯·é€‰æ‹©æ­£ç¡®çš„è‹±æ–‡å•è¯</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼3: è‹±æ–‡å•è¯è¯»éŸ³ + 4ä¸ªè‹±æ–‡å•è¯é€‰é¡¹ -->
    <view wx:elif="{{currentQuestion.type === 'LISTENING'}}" class="word-display">
      <view class="audio-icon" bindtap="playAudio">ğŸ”Š</view>
      <text class="question-hint">å¬éŸ³é€‰è¯</text>
    </view>
    
    <!-- é€‰æ‹©é¢˜æ¨¡å¼4: é€‰è¯å¡«ç©º -->
    <view wx:elif="{{currentQuestion.type === 'FILL_IN_BLANK'}}" class="word-display">
      <view class="sentence-display">
        <text class="sentence-text">{{currentQuestion.sentence}}</text>
      </view>
      <text class="question-hint">é€‰æ‹©æ­£ç¡®çš„å•è¯å¡«ç©º</text>
    </view>
    
    <!-- é»˜è®¤æ˜¾ç¤º -->
    <view wx:else class="word-display">
      <text class="word-text">{{currentTask.vocabulary.word}}</text>
    </view>

    <!-- é€‰é¡¹åˆ—è¡¨ -->
    <view class="options-list">
      <view 
        wx:for="{{currentQuestion.options}}" 
        wx:key="id"
        class="option-item {{selectedAnswer === item.content ? 'selected' : ''}} {{isAnswered && item.content === currentQuestion.correctAnswer ? 'correct' : ''}} {{isAnswered && selectedAnswer === item.content && !isCorrect ? 'wrong' : ''}}"
        data-answer="{{item.content}}"
        bindtap="selectAnswer"
      >
        <view class="option-label">{{index === 0 ? 'A' : index === 1 ? 'B' : index === 2 ? 'C' : 'D'}}</view>
        <view class="option-content">{{item.content}}</view>
        <view wx:if="{{isAnswered && item.content === currentQuestion.correctAnswer}}" class="option-icon">âœ“</view>
        <view wx:elif="{{isAnswered && selectedAnswer === item.content && !isCorrect}}" class="option-icon">âœ—</view>
      </view>
    </view>

    <!-- ç»“æœåé¦ˆ -->
    <view wx:if="{{showResult}}" class="result-feedback {{isCorrect ? 'correct-feedback' : 'wrong-feedback'}}">
      <view class="feedback-icon">{{isCorrect ? 'âœ“' : 'âœ—'}}</view>
      <view class="feedback-text">
        {{isCorrect ? 'å›ç­”æ­£ç¡®ï¼' : 'ç­”é”™äº†'}}
      </view>
      <view wx:if="{{!isCorrect}}" class="correct-answer">
        æ­£ç¡®ç­”æ¡ˆï¼š{{currentQuestion.correctAnswer}}
      </view>
      <view class="meaning-section">
        <view class="meaning-label">é‡Šä¹‰ï¼š</view>
        <view class="meaning-text">{{currentTask.vocabulary.primaryMeaning}}</view>
        <view wx:if="{{currentTask.vocabulary.secondaryMeaning}}" class="meaning-secondary">
          {{currentTask.vocabulary.secondaryMeaning}}
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® / ç»§ç»­æŒ‰é’® -->
    <view class="submit-section">
      <button 
        wx:if="{{!isAnswered}}" 
        class="submit-btn" 
        bindtap="submitAnswer" 
        disabled="{{!selectedAnswer}}"
      >
        æäº¤ç­”æ¡ˆ
      </button>
      <button 
        wx:elif="{{isAnswered && !isCorrect}}" 
        class="submit-btn continue-btn" 
        bindtap="nextQuestion"
      >
        ç»§ç»­
      </button>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-value correct-color">{{correctCount}}</text>
        <text class="stat-label">æ­£ç¡®</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value wrong-color">{{wrongCount}}</text>
        <text class="stat-label">é”™è¯¯</text>
      </view>
    </view>
  </view>
</view>
