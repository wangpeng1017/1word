<!--pages/study/study.wxml-->
<view class="container">
  <!-- 头部进度 -->
  <view class="header">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progress}}%"></view>
    </view>
    <view class="progress-text">
      <text>{{currentIndex + 1}}/{{totalCount}}</text>
      <text class="exit-btn" bindtap="exitStudy">退出</text>
    </view>
  </view>

  <!-- 加载中 -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>加载中...</text>
  </view>

  <!-- 答题区域 -->
  <view wx:else class="study-content">
    <!-- 单词展示 -->
    <view class="word-section">
      <view class="word-main">{{currentTask.vocabulary.word}}</view>
      <view wx:if="{{currentTask.vocabulary.phonetic}}" class="word-phonetic">
        [{{currentTask.vocabulary.phonetic}}]
      </view>
      <view wx:if="{{currentTask.vocabulary.partOfSpeech && currentTask.vocabulary.partOfSpeech.length > 0}}" class="word-pos">
        {{currentTask.vocabulary.partOfSpeech.join(' ')}}
      </view>
    </view>

    <!-- 题型说明 -->
    <view class="question-type">
      <text wx:if="{{currentQuestion.type === 'ENGLISH_TO_CHINESE'}}">请选择正确的中文释义</text>
      <text wx:elif="{{currentQuestion.type === 'CHINESE_TO_ENGLISH'}}">请选择正确的英文单词</text>
      <text wx:elif="{{currentQuestion.type === 'LISTENING'}}">听音选词</text>
      <text wx:elif="{{currentQuestion.type === 'FILL_IN_BLANK'}}">选词填空</text>
    </view>

    <!-- 选项列表 -->
    <view class="options-list">
      <view 
        wx:for="{{currentQuestion.options}}" 
        wx:key="id"
        class="option-item {{selectedAnswer === item.content ? 'selected' : ''}} {{isAnswered && item.content === currentQuestion.correctAnswer ? 'correct' : ''}} {{isAnswered && selectedAnswer === item.content && !isCorrect ? 'wrong' : ''}}"
        data-answer="{{item.content}}"
        bindtap="selectAnswer"
      >
        <view class="option-label">{{index === 0 ? 'A' : index === 1 ? 'B' : index === 2 ? 'C' : 'D'}}</view>
        <view class="option-content">{{item.content}}</view>
        <view wx:if="{{isAnswered && item.content === currentQuestion.correctAnswer}}" class="option-icon">✓</view>
        <view wx:elif="{{isAnswered && selectedAnswer === item.content && !isCorrect}}" class="option-icon">✗</view>
      </view>
    </view>

    <!-- 结果反馈 -->
    <view wx:if="{{showResult}}" class="result-feedback {{isCorrect ? 'correct-feedback' : 'wrong-feedback'}}">
      <view class="feedback-icon">{{isCorrect ? '✓' : '✗'}}</view>
      <view class="feedback-text">
        {{isCorrect ? '回答正确！' : '答错了'}}
      </view>
      <view wx:if="{{!isCorrect}}" class="correct-answer">
        正确答案：{{currentQuestion.correctAnswer}}
      </view>
      <view class="meaning-section">
        <view class="meaning-label">释义：</view>
        <view class="meaning-text">{{currentTask.vocabulary.primaryMeaning}}</view>
        <view wx:if="{{currentTask.vocabulary.secondaryMeaning}}" class="meaning-secondary">
          {{currentTask.vocabulary.secondaryMeaning}}
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view wx:if="{{!isAnswered}}" class="submit-section">
      <button class="submit-btn" bindtap="submitAnswer" disabled="{{!selectedAnswer}}">
        提交答案
      </button>
    </view>

    <!-- 统计信息 -->
    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-value correct-color">{{correctCount}}</text>
        <text class="stat-label">正确</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value wrong-color">{{wrongCount}}</text>
        <text class="stat-label">错误</text>
      </view>
    </view>
  </view>
</view>
