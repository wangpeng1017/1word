<!--pages/index/index.wxml-->
<view class="page">
  <view class="header">
    <view class="date">{{dateStr}}</view>
    <view class="title">今日复习</view>
    <view class="book" wx:if="{{overview.bookName}}">
      <text class="book-name">{{overview.bookName}}</text>
    </view>
  </view>

  <block wx:if="{{state==='ready'}}">
    <view class="stats">
      <view class="stat">
        <view class="num">{{overview.dueCount}}</view>
        <view class="label">今日应复习</view>
      </view>
      <view class="divider"></view>
      <view class="stat">
        <view class="num">{{overview.reviewedCount}}</view>
        <view class="label">已复习</view>
      </view>
      <view class="divider"></view>
      <view class="stat">
        <view class="num">{{overview.timeString}}</view>
        <view class="label">今日用时</view>
      </view>
    </view>

    <view class="progress-wrap">
      <progress percent="{{progressPercent}}" stroke-width="8" active activeColor="#2F6BFF" />
      <text class="progress-text">{{progressPercent}}%</text>
    </view>

    <button class="cta" type="primary" bindtap="startReview">
      {{overview.reviewedCount>0 && overview.reviewedCount<overview.dueCount ? '继续复习' : '开始复习'}}
    </button>
  </block>

  <block wx:elif="{{state==='empty'}}">
    <view class="empty">
      <view class="done">今日复习已完成</view>
      
      <!-- 完成态也显示统计数据 -->
      <view class="stats" style="margin-top: 40rpx; margin-bottom: 40rpx;">
        <view class="stat">
          <view class="num">{{overview.dueCount}}</view>
          <view class="label">已完成</view>
        </view>
        <view class="divider"></view>
        <view class="stat">
          <view class="num">{{overview.timeString}}</view>
          <view class="label">今日用时</view>
        </view>
      </view>

      <view class="sub">下次复习预计：{{nextReviewHint}}</view>
    </view>
  </block>

  <block wx:elif="{{state==='loading'}}">
    <view class="skeleton"></view>
  </block>

  <block wx:elif="{{state==='error'}}">
    <view class="error">
      <text>加载失败</text>
      <button size="mini" bindtap="reload">重试</button>
    </view>
  </block>
</view>
