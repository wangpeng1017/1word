### **产品需求文档 (PRD): 智能词汇复习助手**

**V2.0** - 更新日期: 2025-01-07

> 本文档为最新版本，反映了当前系统的实际实现状态。标记为✅的功能已完成，🚧表示进行中，⚪表示待开发。

#### **1. 项目概述**

**1.1. 项目背景与目标**
本项目旨在为上海地区的高中生提供一个基于艾宾浩斯遗忘曲线等记忆算法的智能词汇复大习工具。通过微信小程序方便学生随时随地进行学习，同时提供一个功能强大的 Web 管理后台，供教师进行教学管理、学情跟踪和内容维护。

项目目标是：
*   **提升学习效率**：通过智能化、个性化的复习计划，帮助学生高效记忆单词。
*   **减轻教师负担**：通过数据化、自动化的学情分析与导出功能，方便教师掌握学生学习情况。
*   **实现无缝学习**：支持离线模式，保证学生在各种网络环境下都能完成学习任务。

**1.2. 目标用户**
*   **学生（用户端）**：上海地区的高中生，希望通过手机方便地复习和巩固英语词汇。
*   **教师（管理端）**：高中英语教师，需要管理班级学生的词汇学习进度，并调整教学内容。

---

#### **2. 系统架构与技术选型**

**2.1. 系统架构**
本项目分为三个核心部分：
1.  **微信小程序（移动端）**：面向学生用户，提供核心的单词复习、错题回顾和学习数据查看功能。
2.  **Web 管理后台（PC 端）**：面向教师用户，用于词库维护、学生管理、教学规则配置和数据导出。
3.  **云端服务器与数据库**：负责处理业务逻辑、数据存储与 API 服务。

**2.2. 技术选型建议**
考虑到您将使用 AI 编程工具（如 Cursor）且编程经验较少，我推荐一个现代化、社区活跃且对初学者友好的技术栈：

*   **移动端 (微信小程序)**:
    *   **语言与框架**: 直接使用微信小程序原生开发（WXML + WXSS + JavaScript）。这能 100% 保证所有功能（如音频播放、本地存储、UI 交互）的兼容性和性能。AI 工具对原生小程序的支持也非常好。
    *   **可行性评估**: 您在图片中提到的所有小程序功能，包括离线模式、实时进度保存、多种答题模式、音频播放等，均可在微信小程序环境中**完美实现**。

*   **Web 管理后台 (教师端)**:
    *   **前端框架**: **Next.js (基于 React)**。这是一个非常强大的框架，对 Vercel 部署支持完美，AI 工具对 React 的代码生成能力极强。其文件路由系统也简单直观。
    *   **UI 组件库**: **Ant Design** 或 **MUI**。这些库提供了大量预制好的后台管理组件，可以极大加速开发进程。

*   **后端服务**:
    *   **框架**: **Next.js (API Routes)** 或 **NestJS**。
        *   **建议**: 初期为了快速开发和部署在 Vercel 上，可以直接使用 **Next.js 的 API Routes** 功能来编写后端逻辑。这样前后端就在一个项目里，非常方便。
        *   当项目变得复杂，需要更清晰的后端架构时，可以考虑迁移到 **NestJS** (基于 Node.js 和 TypeScript)，它提供了非常规范和可扩展的架构。
    *   **语言**: **TypeScript**。它为 JavaScript 提供了类型安全，能减少很多潜在的 bug，AI 工具也能根据类型信息生成更准确的代码。

*   **数据库**:
    *   **数据库**: **PostgreSQL**。这是一款功能强大且稳定的开源关系型数据库，非常适合存储结构化的用户信息、词汇数据和学习记录。
    *   **ORM**: **Prisma**。这是一个现代化的数据库工具，能让您用 TypeScript 来操作数据库，自动生成类型，与 AI 编程工具配合起来体验极佳。

**2.3. 部署方案**
*   **Demo 阶段**:
    *   **平台**: **Vercel**。
    *   **实施**: 直接将您的 Next.js 项目（包含前端和 API Routes 后端）关联到 Vercel 账户的 Git 仓库。Vercel 会自动完成构建和部署。对于数据库，可以使用 Vercel Postgres 或 Supabase 等提供的免费 PostgreSQL 服务。
*   **生产阶段**:
    *   **平台**: **阿里云**。
    *   **实施**:
        *   **前端/后端服务**: 使用 **ECS (Elastic Compute Service)** 实例或**容器服务 Kubernetes 版 (ACK)** 来部署您的 Next.js/NestJS 应用。
        *   **数据库**: 使用 **RDS (Relational Database Service)** 并选择 PostgreSQL 实例，方便管理、备份和扩展。
        *   **静态资源存储**: 使用 **OSS (Object Storage Service)** 来存储单词的音频文件和图片，减轻服务器压力并加快访问速度。

---

#### **3. 功能需求详述**

**3.1. 词库系统 (Web 后台功能)**

*   **F-1.1: 基础词库管理** ✅ **已完成**
    *   【需求】应能批量导入、新增、修改、删除词库。词库需覆盖上海高中阶段全部考纲词汇。
    *   【亮点】**支持后台配置词库更新**：允许教师动态增减词库，而无需重新发布小程序。
    *   【实现状态】
        *   ✅ CRUD API 完成（/api/vocabularies）
        *   ✅ 批量导入/导出 Excel 功能
        *   ✅ 支持10000条词汇的页面显示
        *   ✅ 搜索、筛选功能（按难度、高频词）

*   **F-1.2: 单词信息维护** ✅ **已完成**
    *   【需求】每个单词条目需包含：英文单词、词性（可多选）、中文释义（区分核心/延伸义）、音标（英/美可选）、真人发音音频（支持上传）、实体图片（支持上传）。
    *   【需求】可标注单词是否为高考高频项。
    *   【实现状态】
        *   ✅ 支持完整的单词信息字段
        *   ✅ 支持美式/英式音标和音频
        *   ✅ 集成 Vercel Blob 存储，支持音频和图片上传
        *   ✅ 高频词和难度等级标注（EASY/MEDIUM/HARD）
        *   ✅ 分离的 word_audios 和 word_images 表支持多个音频/图片

*   **F-1.3: 配套题目生成与管理** ✅ **已完成**
    *   【需求】系统应支持为每个单词关联至少3道“英译汉”选择题。
    *   【需求】每道题包含1个正确答案和3个干扰项。教师在录入时，应能方便地添加易混淆词义作为干扰项（如 "adapt" vs "adopt"）。
    *   【实现状态】
        *   ✅ 支持4种题型：英译汉、汉译英、听音选词、选词填空
        *   ✅ 题目 CRUD API （/api/questions）
        *   ✅ 每个题目支持4个选项，1个正确答案
        *   ✅ 支持批量导入题目
        *   ✅ question_options 表存储选项详情

**3.2. 数据记录与导出系统 (核心为 Web 后台功能)**

*   **F-2.1: 学员与班级管理** ✅ **已完成**
    *   【需求】支持批量导入学生名单（姓名、学号），并能将学生分配到不同班级。
    *   【实现状态】
        *   ✅ 学生 CRUD API （/api/students）
        *   ✅ 班级 CRUD API （/api/classes）
        *   ✅ 支持批量导入学生 Excel
        *   ✅ 学生和班级关联管理
        *   ✅ 班级删除保护：有学生的班级不能删除，弹窗提示
        *   ✅ 教师管理功能

*   **F-2.2: 学习数据记录** 🚧 **进行中**
    *   【需求】系统需自动记录学生的每一次复习：完成率、正确率、总耗时、开始/结束时间。
    *   【需求】详细记录每一道错题：错误单词、时间、错误选项/内容、正确答案。
    *   【需求】统计每个单词的累计错误次数和最近3次复习的正确率。
    *   【实现状态】
        *   ✅ study_records 表：记录每次学习会话的统计数据
        *   ✅ wrong_questions 表：记录每道错题的详细信息
        *   ✅ word_masteries 表：跟踪单词掌握度、连续正确次数等
        *   🚧 API 接口开发中

*   **F-2.3: 数据导出功能** ⚪ **待开发**
    *   【需求】支持按学员、班级、时间段筛选数据。
    *   【需求】支持将筛选后的学习报告和错题本批量导出为 Excel (.xlsx)、PDF 和 Word 格式。
    *   【需求】导出内容可按“单词”或“错误次数”排序。
    *   【亮点】**支持后台实现模板更改**：允许管理员自定义导出文件的样式和格式。
    *   【实现状态】
        *   ⚪ 待开发

**3.3. 智能复习计划系统**

*   **F-3.1: 复习周期逻辑 (后台配置 + 小程序实现)** 🚧 **进行中**
    *   【需求】基于记忆算法（如艾宾浩斯曲线），为每个学生自动生成每日复习单词 list。
    *   【需求】新学单词按计划纳入当日复习。
    *   【实现状态】
        *   ✅ study_plans 表：学生个人学习计划
        *   ✅ daily_tasks 表：每日任务管理
        *   ✅ plan_classes 表：班级层面的学习计划
        *   ✅ 艾宾浩斯算法库 (lib/ebbinghaus.ts)
        *   🚧 API 接口开发中

*   **F-3.2: 单词筛选与掌握规则 (后台配置 + 小程序实现)** 🚧 **进行中**
    *   【需求】若一个单词连续3次复习正确率100%，则判定为“已掌握”，自动从后续复习流中移除。
    *   【需求】累计错误次数 ≥ 3次的单词，标记为“重点难点”，优先安排复习。
    *   【实现状态】
        *   ✅ word_masteries 表支持 consecutiveCorrect 字段
        *   ✅ isMastered 和 isDifficult 标记字段
        *   🚧 自动更新逻辑开发中

*   **F-3.3: 个性化调整 (后台功能)** ⚪ **待开发**
    *   【亮点】**支持老师后台手动添加、调整**指定学生的每日复习 list。
    *   【实现状态】
        *   ⚪ 待开发

**3.4. 微信小程序功能**

*   **F-4.1: 核心界面** ✅ **已完成**
    *   【需求】首页布局简洁，仅提供三大入口：“今日复习”、“错题本”、“我的成果”。
    *   【实现状态】
        *   ✅ 登录页面
        *   ✅ 首页布局和导航
        *   ✅ 学习统计展示

*   **F-4.2: 答题模式** ⚪ **待开发**
    *   【需求】复习过程中，顶部显示进度（第 X/Y 个）和已用时。中部为题目区，底部为答题区和趣味进度条。
    *   **模式1：英选汉**（英文单词 + 4 个汉语选项）
    *   **模式2：汉选英**（汉语 + 4 个英文单词选项）
    *   **模式3：听音选词**（英文单词读音 + 4 个英文单词选项）
    *   **模式4：选词填空**（英文句子挖空，从 4 个单词中选择）
    *   【交互】选择题点击选项即判断对错。正确则自动进入下一题；错误则显示正确答案，用户需手动点击“继续”。
    *   【实现状态】
        *   ✅ 后端支持4种题型的数据结构
        *   ⚪ 小程序答题界面待开发

*   **F-4.3: 进度保存与防误触** ⚪ **待开发**
    *   【需求】每答完一题，自动保存当前进度（已答题数、用时、临时错题记录）。
    *   【需求】因故退出（如闪退、切后台）后，重新打开 APP 时弹窗提示“是否继续上次复习？”。选择继续则恢复到退出前的题目界面。
    *   【需求】若上次复习未完成且超过 24 小时（**该时长需支持后台手动设置**），则该次记录记为“中断”，学生可手动选择“补学”。
    *   【实现状态】
        *   ✅ system_configs 表支持配置管理
        *   ✅ daily_tasks 表支持 INTERRUPTED 状态
        *   ⚪ 小程序进度保存功能待开发

*   **F-4.4: 离线模式** ⚪ **待开发**
    *   【需求】小程序启动时，若有网络，可下载当日复习单词包（含题目、音频等）。
    *   【需求】下载后，在无网络环境下可正常完成复习流程。
    *   【需求】再次联网后，本地学习数据自动同步至服务器。
    *   【实现状态】
        *   ⚪ 待开发

---

#### **4. 开发路线图 (Roadmap) 建议**

1.  **第一阶段 (MVP - 最小可行产品)**
    *   **目标**: 快速上线核心功能，验证产品价值。
    *   **功能**:
        *   后台：完成词库导入与单词信息维护 (F-1.1, F-1.2)。
        *   后台：实现基础的学生管理 (F-2.1)。
        *   小程序：实现用户登录、每日复习 list 获取。
        *   小程序：实现答题模式 1 和 2 (F-4.2)。
        *   小程序：完成最基础的学习数据记录与展示 (F-2.2, F-4.1 中的“我的成果”)。
    *   **部署**: 全部部署在 Vercel 上。

2.  **第二阶段 (功能完善)**
    *   **目标**: 完善核心体验，增加教师管理能力。
    *   **功能**:
        *   后台：开发数据导出功能 (F-2.3)。
        *   后台：实现智能复习规则配置 (F-3.1, F-3.2)。
        *   后台：实现教师手动调整学生学习计划 (F-3.3)。
        *   小程序：上线答题模式 3 和 4。
        *   小程序：开发错题本功能。
        *   小程序：实现进度保存与异常退出处理 (F-4.3)。

3.  **第三阶段 (高级功能与性能优化)**
    *   **目标**: 提升产品竞争力和用户体验。
    *   **功能**:
        *   小程序：开发并上线离线模式 (F-4.4)。
        *   后台：实现导出模板自定义功能。
        *   全端：UI/UX 优化，增加趣味性元素（如进度条动画）。
    *   **部署**: 准备从 Vercel 迁移至阿里云生产环境。

---

#### **5. 当前实现状态总结 (2025-01-07)**

**5.1. 已完成功能 ✅**

**Web 管理后台：**
1. 认证系统
   - 教师/学生登录、注册
   - JWT Token 认证
   - 角色权限管理

2. 词库管理
   - CRUD 操作 (10000条词汇支持)
   - 批量导入/导出 Excel
   - 搜索、筛选功能（难度、高频词）
   - 支持英/美音标和音频
   - Vercel Blob 存储集成（音频/图片上传）
   - 多音频/多图片支持 (word_audios, word_images 表)

3. 题目管理
   - 4种题型：英译汉、汉译英、听音选词、选词填空
   - 题目 CRUD API
   - 批量导入题目
   - 每题 4 个选项，1 个正确答案

4. 学生与班级管理
   - 学生 CRUD API
   - 班级 CRUD API
   - 批量导入学生 Excel
   - 班级删除保护（有学生的班级不能删除，弹窗提示）
   - 教师管理功能

**数据库设计：**
- 18 个数据表完整设计
- 支持艾宾浩斯复习算法的数据结构
- 学习记录、错题跟踪、单词掌握度管理

**微信小程序：**
- 登录页面
- 首页布局和导航
- 学习统计展示

**5.2. 进行中功能 🚧**

1. 学习数据记录 API
   - study_records 表已就绪
   - wrong_questions 表已就绪
   - word_masteries 表已就绪
   - API 接口开发中

2. 智能复习计划
   - study_plans 表已就绪
   - daily_tasks 表已就绪
   - plan_classes 表已就绪
   - 艾宾浩斯算法库已实现 (lib/ebbinghaus.ts)
   - API 接口开发中

**5.3. 待开发功能 ⚪**

**Web 管理后台：**
1. 数据导出功能 (Excel/PDF/Word)
2. 统计报表和数据可视化
3. 教师手动调整学生学习计划
4. 导出模板自定义

**微信小程序：**
1. 答题界面（4种题型）
2. 错题本功能
3. 学习记录查看
4. 进度保存与恢复
5. 离线模式

**5.4. 技术栈**

**前端：**
- Next.js 15 (React 18)
- TypeScript
- Ant Design 5
- Tailwind CSS

**后端：**
- Next.js API Routes
- Prisma ORM
- PostgreSQL
- JWT 认证

**存储：**
- Vercel Postgres (数据库)
- Vercel Blob (文件存储)

**部署：**
- Vercel (Demo 阶段)
- 计划迁移到阿里云 (生产环境)

**5.5. 下一步工作**

1. **优先级 P0** - 完成核心学习闭环
   - 完成学习数据记录 API
   - 完成智能复习计划 API
   - 开发小程序答题功能

2. **优先级 P1** - 增强用户体验
   - 小程序错题本
   - 小程序学习记录查看
   - Web 后台统计报表

3. **优先级 P2** - 高级功能
   - 数据导出 (Excel/PDF/Word)
   - 离线模式
   - 进度保存与恢复

---

祝您项目开发顺利！这份 PRD 结合了您的需求和技术背景，可以直接作为您使用 AI 编程的指导蓝图。
