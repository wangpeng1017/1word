# 完整测试数据初始化指南

## 概述

本脚本一键创建小程序完整测试数据，包含教师、班级、学生、词汇、题目、学习计划和每日任务，用于端到端闭环测试。

## 快速开始

### 1. 运行脚本

```bash
cd E:\trae\1单词\web-admin
node scripts/init-complete-test-data.js
```

### 2. 预期结果

脚本会自动创建以下测试数据：

| 数据类型 | 数量 | 说明 |
|---------|------|------|
| 👨‍🏫 教师 | 1个 | 测试老师 (teacher@test.com) |
| 🏫 班级 | 1个 | 测试班级（高三1班） |
| 👨‍🎓 学生 | 3个 | 学号: 2025001, 2025002, 2025003 |
| 📚 词汇 | 20个 | 常用英语单词 |
| ❓ 题目 | 80个 | 每个词汇4种题型 |
| 📝 学习计划 | 60个 | 每个学生20个词汇 |
| ✅ 今日任务 | 30个 | 每个学生10个今日任务 |

## 测试账号信息

### 教师账号
- **邮箱**: teacher@test.com
- **密码**: 123456
- **用途**: 管理后台登录

### 学生账号
| 学号 | 姓名 | 密码 | 邮箱 |
|------|------|------|------|
| 2025001 | 张三 | 123456 | 2025001@test.com |
| 2025002 | 李四 | 123456 | 2025002@test.com |
| 2025003 | 王五 | 123456 | 2025003@test.com |

**小程序登录**：使用学号作为账号，密码为 123456

## 数据详情

### 词汇列表（20个）
```
apple, book, cat, dog, egg, fish, good, happy, ice, jump,
kind, love, moon, nice, pen, run, sun, tree, water, yellow
```

每个词汇包含：
- 单词 (word)
- 中文释义 (primaryMeaning)
- 音标 (phonetic)
- 词性 (partOfSpeech)
- 例句 (sentence)

### 题型说明

每个词汇自动生成4种题型：

1. **英译中 (ENGLISH_TO_CHINESE)**
   - 题目：显示英文单词
   - 选项：4个中文释义（1个正确，3个干扰项）

2. **中译英 (CHINESE_TO_ENGLISH)**
   - 题目：显示中文释义
   - 选项：4个英文单词（1个正确，3个干扰项）

3. **听力题 (LISTENING)**
   - 题目：播放单词音频
   - 选项：4个英文单词（1个正确，3个干扰项）

4. **填空题 (FILL_IN_BLANK)**
   - 题目：显示例句（单词位置用 _____ 表示）
   - 选项：4个英文单词（1个正确，3个干扰项）

### 学习流程

```
学生登录 
  ↓
查看今日任务（10个词汇）
  ↓
完成学习（每个词汇4道题）
  ↓
记录学习数据
  ↓
查看统计报告
```

## 测试场景

### 场景1：学生首次登录
1. 打开小程序
2. 使用学号 `2025001` 和密码 `123456` 登录
3. 查看今日任务列表（应显示10个单词）
4. 进入学习页面

### 场景2：完成学习任务
1. 选择第一个单词开始学习
2. 依次完成4种题型：英译中 → 中译英 → 听力 → 填空
3. 查看单词掌握状态
4. 继续下一个单词

### 场景3：查看学习数据
1. 完成部分任务后，查看学习统计
2. 检查正确率、完成进度
3. 查看错题记录
4. 查看学习计划

### 场景4：教师管理
1. 使用教师账号登录管理后台
2. 查看学生学习情况
3. 查看班级统计数据
4. 管理词汇和题目

## 脚本特性

### 幂等性设计
脚本支持多次运行，会自动检测已存在的数据：
- ✅ 已存在的数据会跳过创建
- ✅ 只创建缺失的数据
- ✅ 不会产生重复数据

### 安全性
- 密码使用 bcrypt 加密存储
- 符合数据库外键约束
- 自动处理关联关系

## 故障排查

### 问题1：数据库连接失败
```
错误: Can't reach database server
```
**解决方案**:
- 检查 `.env` 文件中的 `DATABASE_URL` 配置
- 确认数据库服务正在运行
- 验证网络连接

### 问题2：账号已存在
```
错误: Unique constraint failed
```
**解决方案**:
- 正常现象，脚本会自动跳过已存在的数据
- 如需重新创建，请先清理数据库

### 问题3：缺少依赖
```
错误: Cannot find module 'bcryptjs'
```
**解决方案**:
```bash
npm install bcryptjs
```

## 数据清理

如需重新初始化全部数据：

```bash
# 方法1：使用 Prisma Studio 手动删除
npx prisma studio

# 方法2：重置数据库（慎用！）
npx prisma migrate reset
npx prisma db push
```

## API测试建议

### 测试学生登录
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "studentNo": "2025001",
    "password": "123456"
  }'
```

### 测试获取今日任务
```bash
curl -X GET http://localhost:3000/api/daily-tasks?studentId=STUDENT_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 测试提交答案
```bash
curl -X POST http://localhost:3000/api/study-records \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "STUDENT_ID",
    "vocabularyId": "VOCAB_ID",
    "questionId": "QUESTION_ID",
    "answer": "correct_answer",
    "isCorrect": true
  }'
```

## 扩展功能

### 增加更多学生
编辑脚本第154-158行的 `studentData` 数组：
```javascript
const studentData = [
  { studentNo: '2025001', name: '张三' },
  { studentNo: '2025002', name: '李四' },
  { studentNo: '2025003', name: '王五' },
  { studentNo: '2025004', name: '赵六' }, // 新增
];
```

### 增加更多词汇
编辑脚本第23-44行的 `vocabulariesData` 数组，添加更多单词数据。

### 调整今日任务数量
编辑脚本第323行：
```javascript
const tasksToCreate = vocabularies.slice(0, 10); // 改为需要的数量
```

## 下一步

初始化完成后，您可以：

1. ✅ 在小程序中使用学生账号登录测试
2. ✅ 在管理后台使用教师账号管理数据
3. ✅ 运行端到端测试脚本验证功能
4. ✅ 开始开发新功能

## 相关文档

- [数据库测试指南](../数据库测试指南.md)
- [Playwright MCP 测试总结](../PLAYWRIGHT_MCP_测试总结.md)
- [脚本使用说明](./使用说明.md)

## 支持

如遇问题，请检查：
1. Node.js 版本 (推荐 v18+)
2. 数据库连接配置
3. Prisma Client 是否已生成 (`npx prisma generate`)
4. 错误日志输出
