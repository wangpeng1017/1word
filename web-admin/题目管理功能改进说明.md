# 题目管理功能改进说明

## ✅ 已完成的改进

### 1. 新增词汇筛选功能

**位置**：题目管理页面顶部筛选区域

**功能说明**：
- 下拉选择框可选择特定词汇
- 支持搜索功能，可输入词汇名称快速查找
- 选择后仅显示该词汇相关的题目
- 可清空筛选恢复显示所有题目

**使用方法**：
```
1. 打开"题目管理"页面
2. 点击"选择词汇"下拉框
3. 搜索或滚动选择要查看的词汇
4. 表格自动更新，仅显示该词汇的题目
```

**技术实现**：
- 页面加载时自动获取所有词汇列表
- 使用词汇ID作为筛选参数
- 支持模糊搜索（不区分大小写）

### 2. 新增题型筛选功能

**位置**：题目管理页面顶部筛选区域

**功能说明**：
- 下拉选择4种题型之一
- 选择后仅显示该题型的题目
- 可清空筛选恢复显示所有题型

**支持的题型**：
- 英选汉 (ENGLISH_TO_CHINESE)
- 汉选英 (CHINESE_TO_ENGLISH)
- 听音选词 (LISTENING)
- 选词填空 (FILL_IN_BLANK)

**使用方法**：
```
1. 打开"题目管理"页面
2. 点击"选择题型"下拉框
3. 选择要查看的题型
4. 表格自动更新，仅显示该题型的题目
```

### 3. 组合筛选

**功能说明**：
- 可同时选择词汇和题型进行筛选
- 例如：查看"specific"这个词的"英选汉"题目
- 清空筛选按钮可一键清除所有筛选条件

**示例场景**：
```
场景1：查看某个词汇的所有题目
- 选择词汇：refugee
- 题型：全部题型
- 结果：显示refugee的4道题（英选汉、汉选英、听音选词、填空）

场景2：查看某种题型的所有题目
- 词汇：全部词汇
- 选择题型：听音选词
- 结果：显示所有50个词汇的听音选词题（共50道）

场景3：组合筛选
- 选择词汇：specific
- 选择题型：填空题
- 结果：仅显示specific的填空题（1道）
```

### 4. 显示所有题目选项

**改进前**：
- 仅显示"选项数"列（数字）
- 无法直接查看具体选项内容
- 需要点击编辑才能看到选项

**改进后**：
- 题目内容列直接展示所有选项
- 按A、B、C、D顺序排列
- 正确答案标记绿色对勾 ✓
- 填空题显示完整句子

**显示格式**：
```
题目内容
  specific
  句子: The doctor gave me _____ instructions. (仅填空题)

选项:
  A. specific ✓
  B. superior
  C. resident
  D. regard
```

**优点**：
- 一目了然，无需点击查看
- 快速检查题目和答案是否正确
- 方便批量审核题目质量
- 移除了冗余的"选项数"列

## 📊 界面布局

### 筛选区域布局

```
┌─────────────────────────────────────────────────────────┐
│ 题目管理                          [下载模板] [批量导入] [新增题目] │
├─────────────────────────────────────────────────────────┤
│ 筛选： [选择词汇 ▼]  [选择题型 ▼]  [清空筛选]           │
└─────────────────────────────────────────────────────────┘
```

### 表格列布局

| 词汇 | 题型 | 题目内容（含选项） | 正确答案 | 操作 |
|------|------|-------------------|----------|------|
| 120px | 100px | 自适应（最大400px） | 150px | 150px |

## 🔧 技术实现细节

### 前端代码改动

**文件**：`app/admin/questions/page.tsx`

**主要改动**：
1. 新增状态管理：
   - `vocabularies` - 词汇列表
   - `filters` - 筛选条件（vocabularyId, type）

2. 新增获取词汇列表函数：
   ```typescript
   const fetchVocabularies = async () => {
     // 获取所有词汇用于筛选下拉框
   }
   ```

3. 修改题目获取函数：
   ```typescript
   const fetchQuestions = async () => {
     // 添加筛选参数到API请求
     if (filters.vocabularyId) {
       params.append('vocabularyId', filters.vocabularyId)
     }
     if (filters.type) {
       params.append('type', filters.type)
     }
   }
   ```

4. 改进题目内容渲染：
   ```typescript
   render: (_, record) => (
     <div>
       <div>{record.content}</div>
       <div>选项: 
         {record.options.map((opt, idx) => (
           <div>{String.fromCharCode(65 + idx)}. {opt.content} {opt.isCorrect && '✓'}</div>
         ))}
       </div>
     </div>
   )
   ```

### API支持

**文件**：`app/api/questions/route.ts`

**已有支持**：
- ✅ 支持 `vocabularyId` 参数筛选
- ✅ 支持 `type` 参数筛选
- ✅ 支持分页参数

**API请求示例**：
```
GET /api/questions?page=1&limit=20&vocabularyId=xxx&type=LISTENING
```

## 📱 使用指南

### 快速筛选特定词汇的题目

1. 打开题目管理页面
2. 在"选择词汇"下拉框中输入词汇名称（如 "specific"）
3. 选择该词汇
4. 查看该词汇的所有4种题型

### 检查某类题型的题目质量

1. 打开题目管理页面
2. 在"选择题型"下拉框中选择"听音选词"
3. 逐页查看所有听力题
4. 检查选项是否合理、答案是否正确

### 批量审核题目

1. 使用筛选功能定位到需要审核的题目范围
2. 在表格中直接查看每道题的完整信息
3. 发现问题点击"编辑"按钮进行修改
4. 或记录问题题目ID用于批量处理

## ⚠️ 注意事项

1. **词汇列表加载**
   - 词汇列表限制1000个，如果词汇数超过需要调整
   - 页面首次加载时会自动获取词汇列表

2. **筛选与分页**
   - 筛选后自动重置到第1页
   - 分页在筛选条件内生效

3. **清空筛选**
   - 点击"清空筛选"按钮会清除所有筛选条件
   - 自动重置到第1页

4. **选项显示**
   - 选项按order字段排序显示
   - 正确答案有绿色标记
   - 填空题额外显示句子内容

## 🎯 后续可优化项

1. **性能优化**
   - 如果词汇数量很大，可考虑词汇下拉框支持远程搜索
   - 选项显示可以添加展开/收起功能

2. **功能增强**
   - 添加批量操作功能（批量删除、批量导出）
   - 添加题目预览功能（模拟学生端显示）
   - 添加题目统计功能（各题型数量、正确率等）

3. **用户体验**
   - 记住用户的筛选条件（localStorage）
   - 添加快速筛选按钮（一键查看某词汇）
   - 支持URL参数传递筛选条件

## ✅ 测试建议

### 功能测试

1. **词汇筛选测试**
   ```
   - 选择词汇"refugee"，验证仅显示4道题
   - 搜索功能输入"spec"，验证能找到"specific"
   - 清空筛选，验证恢复显示所有题目
   ```

2. **题型筛选测试**
   ```
   - 选择"英选汉"，验证仅显示该题型
   - 选择"听音选词"，验证仅显示50道听力题
   - 清空筛选，验证恢复显示所有题型
   ```

3. **组合筛选测试**
   ```
   - 同时选择词汇和题型，验证结果正确
   - 先选题型再选词汇，验证顺序无影响
   - 修改其中一个筛选条件，验证另一个保持
   ```

4. **选项显示测试**
   ```
   - 查看英选汉题目，验证选项显示中文
   - 查看填空题，验证显示例句
   - 查看所有题型，验证正确答案有绿色标记
   ```

### 数据验证

```sql
-- 验证某个词汇的题目数量
SELECT v.word, COUNT(*) as question_count
FROM questions q
JOIN vocabularies v ON q.vocabulary_id = v.id
WHERE v.word = 'specific'
GROUP BY v.word;

-- 验证题型分布
SELECT type, COUNT(*) as count
FROM questions
GROUP BY type;

-- 验证选项完整性
SELECT q.id, q.content, COUNT(o.id) as option_count
FROM questions q
LEFT JOIN question_options o ON q.id = o.question_id
GROUP BY q.id
HAVING option_count != 4;
```

---

**更新时间**: 2025年11月6日  
**状态**: ✅ 已完成  
**影响范围**: 题目管理页面、API无需改动
